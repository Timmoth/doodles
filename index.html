<!DOCTYPE html>
<html lang="en" class="bg-gray-900 text-gray-100">

<head>
  <meta charset="UTF-8">
  <title>doodles</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: linear-gradient(to bottom, #0f172a, #1e293b, #000);
    }

    .label-font {
      font-family: Consolas, monospace;
    }

    .pop {
      transform: scale(1.3);
      transition: transform 0.15s ease;
    }
  </style>
</head>

<body
  class="p-6 flex flex-col items-center min-h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950 text-gray-200">

  <!--
   ________________________________________
  /                                        \
 |   It's open source - just check out     |
 |   the repo ;)                           |
 |                                         |
 |   https://github.com/Timmoth/doodles    |
  \________________________________________/
          \   ^__^
           \  (oo)\_______
              (__)\       )\/\
                  ||----w |
                  ||     ||
-->

  <h1 class="text-2xl font-semibold mb-4">doodles</h1>

  <div id="gallery"
    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 overflow-y-auto max-h-screen"></div>

  <!-- Overlay -->
  <div id="overlay"
    class="hidden fixed inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center z-50 p-4">
    <button id="overlay-close" class="absolute top-4 right-4 text-white text-2xl">Ã—</button>
    <img id="overlay-img" class="max-w-full max-h-[80vh] rounded-lg shadow-lg mb-2 z-10" src="" alt="">
    <div id="overlay-caption"
      class="text-[10px] text-gray-200 bg-black/50 px-2 py-1 rounded label-font z-10 flex items-center gap-1"></div>
  </div>

  <script>
    function formatDate(isoString) {
      const date = new Date(isoString);
      const options = { month: 'short', year: '2-digit' };
      return date.toLocaleDateString(undefined, options);
    }

    async function loadGallery() {
      const res = await fetch("doodles/gallery.json");
      const data = await res.json();
      const gallery = document.getElementById("gallery");

      data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
        .forEach(item => {
          const wrapper = document.createElement("div");
          wrapper.className = "relative group";

          const img = document.createElement("img");
          img.src = "doodles/" + item.thumbnail;
          img.alt = item.name;
          img.className = "w-full aspect-square object-cover rounded-lg cursor-pointer hover:opacity-80 transition";

          img.addEventListener("click", (e) => {
            const overlay = document.getElementById("overlay");
            const overlayImg = document.getElementById("overlay-img");
            const overlayCaption = document.getElementById("overlay-caption");

            overlayImg.src = "doodles/" + item.fullsize;
            overlay.classList.remove("hidden");

            // Build caption with ðŸ”—
            overlayCaption.innerHTML = `
              <span id="copy-link" 
                class="cursor-pointer hover:text-blue-400 transition-colors">ðŸ”— ${item.name} / ${formatDate(item.timestamp)}</span>
              
            `;

            // Attach copy handler
            const copyLink = document.getElementById("copy-link");
            copyLink.addEventListener("click", async () => {
              try {
                await navigator.clipboard.writeText(overlayImg.src);
              } catch (err) {
                console.error("Copy failed: ", err);
              }
            });

            e.stopPropagation();
          });

          const name = document.createElement("div");
          name.textContent = `${item.name} / ${formatDate(item.timestamp)}`;
          name.className = "absolute bottom-1 left-1 text-[8px] text-gray-200 bg-black/50 px-1 rounded label-font";

          wrapper.appendChild(img);
          wrapper.appendChild(name);
          gallery.appendChild(wrapper);
        });
    }

    // Close overlay on close button
    document.getElementById("overlay-close").addEventListener("click", () => {
      document.getElementById("overlay").classList.add("hidden");
    });

    // Close overlay on background click
    document.getElementById("overlay").addEventListener("click", (e) => {
      if (e.target.id === "overlay") {
        document.getElementById("overlay").classList.add("hidden");
      }
    });

    loadGallery();
  </script>
</body>

</html>
